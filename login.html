<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ğŸ” Login - Bear Shop</title>
  <style>
    body { background:#0d001a; font-family:Arial,sans-serif; color:white; margin:0; display:flex; flex-direction:column; align-items:center; }
    .navbar { background:#1a001a; width:100%; padding:12px; display:flex; justify-content:center; gap:20px; font-weight:bold; box-shadow:0 0 10px #ff00ff; }
    .navbar a { color:orange; text-decoration:none; }
    .navbar a:hover { color:#ff00ff; }
    h1 { margin:25px 0; color:#ffccff; text-shadow:0 0 10px #ff00ff; }
    .login-box { background:#1a0026; border:2px solid #ff00ff; border-radius:12px; padding:25px; width:320px; box-shadow:0 0 20px #ff00ff55; display:flex; flex-direction:column; gap:12px; }
    .login-box input { background:#0d0d0d; border:1px solid #555; padding:10px; border-radius:5px; color:white; font-size:14px; }
    .login-box input:focus { border:1px solid #ff00ff; outline:none; }
    .login-box button { background:#ff00ff; border:none; color:white; font-weight:bold; padding:10px; border-radius:6px; cursor:pointer; box-shadow:0 0 10px #ff00ff; transition:0.2s; }
    .login-box button:hover { background:#ff33ff; box-shadow:0 0 15px #ff00ff; }
    .switch { margin-top:10px; font-size:13px; color:#ccc; }
    .switch a { color:#ff00ff; cursor:pointer; text-decoration:none; }
  </style>
</head>
<body>
  <nav class="navbar">
    <a href="index.html">ğŸ» Bear Shop</a>
    <a href="shop.html">ğŸ›’ Pet Shop</a>
    <a href="inventory.html">ğŸ’ Inventory</a>
    <a href="history.html">ğŸ“œ History</a>
  </nav>

  <h1>ğŸ” Login to Bear Shop</h1>

  <div class="login-box" id="loginForm">
    <input type="email" id="loginEmail" placeholder="Email" />
    <input type="password" id="loginPassword" placeholder="Password" />
    <button onclick="login()">Login</button>
    <div class="switch">Don't have an account? <a onclick="toggleRegister()">Register</a></div>
  </div>

  <div class="login-box" id="registerForm" style="display:none;">
    <input type="text" id="regUsername" placeholder="Username" />
    <input type="email" id="regEmail" placeholder="Email" />
    <input type="password" id="regPassword" placeholder="Password" />
    <input type="password" id="regConfirm" placeholder="Confirm Password" />
    <button onclick="register()">Register</button>
    <div class="switch">Already have an account? <a onclick="toggleLogin()">Login</a></div>
  </div>

  <!-- âœ… Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>
    // âœ… Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyBUCFW2ffGXPBogDUyd1cDYEt15fHQiz9I",
      authDomain: "bearshop-49b90.firebaseapp.com",
      projectId: "bearshop-49b90",
      storageBucket: "bearshop-49b90.firebasestorage.app",
      messagingSenderId: "764985024020",
      appId: "1:764985024020:web:62e152b71173d2f3c89101"
    };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // âœ… Giá»¯ session login
    auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL);

    // ğŸ”¹ Toggle Forms
    function toggleRegister(){document.getElementById("loginForm").style.display="none";document.getElementById("registerForm").style.display="flex";}
    function toggleLogin(){document.getElementById("loginForm").style.display="flex";document.getElementById("registerForm").style.display="none";}

    // ğŸ”¹ Register User
    function register(){
      const email=document.getElementById("regEmail").value.trim();
      const username=document.getElementById("regUsername").value.trim();
      const password=document.getElementById("regPassword").value.trim();
      const confirm=document.getElementById("regConfirm").value.trim();
      if(!email||!username||!password||!confirm) return alert("âš ï¸ Please fill all fields!");
      if(password!==confirm) return alert("âŒ Passwords do not match!");

      auth.createUserWithEmailAndPassword(email,password).then(async cred=>{
        await db.collection("users").doc(cred.user.uid).set({
          username,email,balance:0,isAdmin:(username==="duc")
        });
        alert("âœ… Account created! Please login now.");
        toggleLogin();
      }).catch(e=>alert("âŒ "+e.message));
    }

    // ğŸ”¹ Login User
    function login(){
      const email=document.getElementById("loginEmail").value.trim();
      const password=document.getElementById("loginPassword").value.trim();
      if(!email||!password) return alert("âš ï¸ Enter email & password!");

      auth.signInWithEmailAndPassword(email,password).then(async cred=>{
        const doc=await db.collection("users").doc(cred.user.uid).get();
        if(!doc.exists) return alert("âŒ User data not found!");

        const userData={uid:cred.user.uid,...doc.data()};
        localStorage.setItem("currentUser",JSON.stringify(userData));
        localStorage.setItem("loggedIn","true"); // âœ… lÆ°u tráº¡ng thÃ¡i login

        alert("âœ… Login successful!");
        window.location.href="index.html";
      }).catch(e=>alert("âŒ "+e.message));
    }
  </script>
</body>
</html>
