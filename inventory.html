<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>üêæ Inventory - Bear Shop</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body { background:#150015; color:white; font-family:Arial,sans-serif; margin:0; text-align:center; }
    .navbar { background:#1a001a; padding:12px 0; display:flex; justify-content:center; gap:25px; font-weight:bold; box-shadow:0 0 10px #ff00ff; }
    .navbar a { color:orange; text-decoration:none; transition:0.2s; }
    .navbar a:hover { color:#ff00ff; text-shadow:0 0 5px #ff00ff; }
    .logo { font-size:20px; }
    h1 { color:#ffccff; text-shadow:0 0 10px #ff00ff; margin-top:15px; }
    .inventory { display:grid; grid-template-columns:repeat(auto-fit,minmax(180px,1fr)); gap:20px; padding:20px; max-width:1000px; margin:auto; }
    .inv-item { background:rgba(40,0,40,0.9); border:2px solid #ff00ff; border-radius:12px; padding:12px; box-shadow:0 0 15px #ff00ff55; text-align:center; transition:0.3s; position:relative; }
    .inv-item:hover { transform:scale(1.05); box-shadow:0 0 25px #ff00ff; }
    .inv-item img { width:100%; max-height:120px; object-fit:contain; border-radius:8px; margin-bottom:8px; box-shadow:0 0 10px #ff00ff33; }
    .inv-item h4 { color:#fff; margin:5px 0; text-shadow:0 0 5px #ff00ff; }
    /* Checkbox */
    .select-item { position:absolute; top:10px; left:10px; transform:scale(1.3); cursor:pointer; }
    /* Button */
    .btn { background:#ff00ff; color:white; border:none; padding:10px 20px; font-weight:bold; border-radius:6px; cursor:pointer; box-shadow:0 0 10px #ff00ff; transition:0.2s; margin:15px auto; display:block; }
    .btn:hover { background:#ff33ff; box-shadow:0 0 20px #ff00ff; }
  </style>
</head>
<body>
  <nav class="navbar">
    <a href="index.html" class="logo rainbow-text">üêª Bear Shop</a>
    <a href="index.html">üéÅ Case Opening</a>
    <a href="shop.html">üõí Pet Shop</a>
    <a href="inventory.html">üéí Inventory</a>
    <a href="history.html">üìú History</a>
    <a id="adminLink" href="admin_withdraws.html" style="display:none;">‚öôÔ∏è Admin</a>
    <span id="userInfo"></span>
  </nav>

  <h1>üêæ Your Inventory</h1>
  <div id="inventoryContainer" class="inventory"></div>

  <button class="btn" onclick="withdrawSelected()">Withdraw Selected</button>

  <script src="script.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const container = document.getElementById("inventoryContainer");
      const currentUser = JSON.parse(localStorage.getItem("currentUser"));
      if (!currentUser) {
        alert("‚ö†Ô∏è Please login first!");
        window.location.href = "login.html";
        return;
      }

      // Show admin link if admin user
      if (currentUser.username === "duc") document.getElementById("adminLink").style.display = "inline-block";

      // Load inventory and ensure every item has an integer id
      let invData = JSON.parse(localStorage.getItem("inventory")) || [];
      invData.forEach(i => {
        if (!i.id || typeof i.id !== "number") {
          i.id = Date.now() + Math.floor(Math.random() * 10000);
        }
      });
      localStorage.setItem("inventory", JSON.stringify(invData));

      // Filter items of current user
      const myItems = invData.filter(i => i.user === currentUser.username);

      if (myItems.length === 0) {
        container.innerHTML = "<h3>‚ö†Ô∏è Your inventory is empty.</h3>";
        return;
      }

      container.innerHTML = ""; // Clear container before render

      myItems.forEach(item => {
        const card = document.createElement("div");
        card.className = "inv-item";

        // Image path logic: pet get its own image; money get Sheckles image
        const imgSrc = item.type === "pet"
          ? `images/${item.item}.png`
          : "images/Sheckles.png";

        card.innerHTML = `
          <input type="checkbox" class="select-item" data-id="${item.id}">
          <img src="${imgSrc}" alt="${item.item}">
          <h4>${item.item}</h4>
        `;
        container.appendChild(card);
      });
    });

    function withdrawSelected() {
      const currentUser = JSON.parse(localStorage.getItem("currentUser"));
      const checkboxes = document.querySelectorAll(".select-item:checked");
      if (checkboxes.length === 0) {
        alert("‚ö†Ô∏è Please select at least one item!");
        return;
      }

      const name = prompt("Enter your in-game name:");
      if (!name) return;

      const link = prompt("Enter your VIP server link:");
      if (!link) return;

      let allItems = JSON.parse(localStorage.getItem("inventory")) || [];
      let withdraws = JSON.parse(localStorage.getItem("withdraws")) || [];

      // Gom t·∫•t c·∫£ item ƒë√£ ch·ªçn th√†nh m·ªôt y√™u c·∫ßu duy nh·∫•t, l·∫•y item names n·ªëi v·ªõi d·∫•u ph·∫©y
      let selectedItems = [];

      checkboxes.forEach(cb => {
        const id = Number(cb.dataset.id);
        const selected = allItems.find(i => i.id === id && i.user === currentUser.username);
        if (selected) {
          selectedItems.push(selected.item);
          // Lo·∫°i b·ªè item kh·ªèi inventory
          allItems = allItems.filter(i => i.id !== id);
        }
      });

      if (selectedItems.length === 0) {
        alert("‚ö†Ô∏è Selected items not found in inventory.");
        return;
      }

      // Th√™m 1 ƒë∆°n r√∫t v·ªõi danh s√°ch item n·ªëi chu·ªói
      withdraws.push({
        user: currentUser.username,
        item: selectedItems.join(", "),
        name,
        link,
        date: new Date().toLocaleString(),
        status: "pending"
      });

      localStorage.setItem("inventory", JSON.stringify(allItems));
      localStorage.setItem("withdraws", JSON.stringify(withdraws));

      alert("‚úÖ Withdraw request sent for selected items!");
      location.reload();
    }
  </script>
</body>
</html>
